tlsmsg = 
uint8<val==0x16> tlsversdata
;

tlsversdata = 
uint16be<val==0x0301> tlsdata
| uint16be<val==0x0302> tlsdata
| uint16be<val==0x0303> tlsdata
;

tlsdata = 
uint16be $1 bytes<feed: sslhandshake>
;

sni = 
uint8<val==0> uint16be $2 bytes<print>
| uint8<val==.> uint16be $2 bytes<discard>
;

maybe_sniext2 = 
| sni maybe_sniext2
;

sniext2 = sni maybe_sniext2
;

sniext = uint16be bytes<reinit_feed: sniext2>
;

extensions = 
| extension extensions
;

extension = 
uint16be<val==0x0> uint16be $3 bytes<reinit_feed: sniext>
| uint16be<val==.> uint16be $3 bytes<discard>
;

sslhandshakedata2 = 
32 bytes
uint8
$2 bytes<discard> 
uint16be
$4 bytes<discard>
uint8
$6 bytes<discard>
uint16
$8 bytes<reinit_feed: extensions>
;

sslhandshakedata = 
uint16be<val==0x0301> sslhandshakedata2
| uint16be<val==0x0302> sslhandshakedata2
| uint16be<val==0x0303> sslhandshakedata2
;

sslhandshake = 
uint8<val==0x1> uint24be $2 bytes<feed: sslhandshakedata>
;

directive entry = sslhandshake ;
directive entry = sslhandshakedata ;
directive entry = extensions ;
directive entry = sniext ;
directive main = tlsmsg ;
